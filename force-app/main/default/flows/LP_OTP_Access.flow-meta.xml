<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>59.0</apiVersion>
    <label>LP OTP Access</label>
    <processType>Flow</processType>
    <status>Active</status>
    <variables>
        <name>recordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <interviewLabel>LP OTP Access {!$Flow.CurrentDateTime}</interviewLabel>
    <startElementReference>Send_OTP</startElementReference>
    <actionCalls>
        <actionCall>
            <name>Send_OTP</name>
            <label>Send OTP</label>
            <actionName>ACH_OTPGenerateAndSend.generateAndSendOTP</actionName>
            <actionType>Apex</actionType>
            <inputParameters>
                <inputParameter>
                    <name>investorIds</name>
                    <value>{!recordId}</value>
                </inputParameter>
            </inputParameters>
            <connector>
                <targetReference>Enter_OTP_Screen</targetReference>
            <actionCalls>
                <actionCall>
                    <name>Send_OTP</name>
                    <actionName>ACH_OTPGenerateAndSend.generateAndSendOTP</actionName>
                    <actionType>Apex</actionType>
                    <inputParameters>
                        <inputParameter>
                            <name>investorIds</name>
                            <value>{!recordId}</value>
                        </inputParameter>
                    </inputParameters>
                    <connector>
                        <targetReference>Enter_OTP_Screen</targetReference>
                    </connector>
                </actionCall>
                <actionCall>
                    <name>Validate_OTP</name>
                    <actionName>ACH_OTPValidate.validateInvestorOTP</actionName>
                    <actionType>Apex</actionType>
                    <inputParameters>
                        <inputParameter>
                            <name>requests</name>
                            <value>{!recordId},{!enteredOTP}</value>
                        </inputParameter>
                    </inputParameters>
                    <connector>
                        <targetReference>OTP_Decision</targetReference>
                    </connector>
                </actionCall>
            </actionCalls>
        <actionName>ACH_OTPValidate.validateInvestorOTP</actionName>
        <actionType>Apex</actionType>
        <inputParameters>
            <name>requests</name>
            <value>{!recordId},{!enteredOTP}</value>
        </inputParameters>
        <connector>
            <targetReference>OTP_Decision</targetReference>
        </connector>
    <screens>
        <screen>
            <name>Enter_OTP_Screen</name>
            <fields>
                <field>
                    <name>enteredOTP</name>
                    <dataType>String</dataType>
                    <isRequired>true</isRequired>
                </field>
            </fields>
            <connector>
                <targetReference>Validate_OTP</targetReference>
            </connector>
        </screen>
        <screen>
            <name>Success_Screen</name>
            <fields>
                <field>
                    <name>successMessage</name>
                    <dataType>String</dataType>
                    <defaultValue>OTP validated! You may now view your data.</defaultValue>
                    <isRequired>false</isRequired>
                    <isOutputOnly>true</isOutputOnly>
                </field>
            </fields>
        </screen>
        <screen>
            <name>Error_Screen</name>
            <fields>
                <field>
                    <name>errorMessage</name>
                    <dataType>String</dataType>
                    <defaultValue>Invalid or expired OTP. Please try again.</defaultValue>
                    <isRequired>false</isRequired>
                    <isOutputOnly>true</isOutputOnly>
                </field>
            </fields>
        </screen>
    </screens>
            <isOutputOnly>true</isOutputOnly>
        </fields>
    </screens>
    <screens>
        <name>Error_Screen</name>
        <fields>
            <name>errorMessage</name>
            <dataType>String</dataType>
            <defaultValue>Invalid or expired OTP. Please try again.</defaultValue>
            <isRequired>false</isRequired>
            <isOutputOnly>true</isOutputOnly>
        </fields>
    </screens>
</Flow>
